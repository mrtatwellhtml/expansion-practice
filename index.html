<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Algebraic Expansion Worksheets</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
            padding: 0 20px;
        }

        .tab {
            padding: 15px 20px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .progress-bar {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
            border-radius: 4px;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: #495057;
        }

        .question {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-number {
            font-weight: 700;
            color: #667eea;
            font-size: 1.1em;
        }

        .question-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-correct {
            background: #d4edda;
            color: #155724;
        }

        .status-incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        .status-unanswered {
            background: #e2e3e5;
            color: #383d41;
        }

        .expression {
            font-size: 1.3em;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            color: #212529;
        }

        .answer-input {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
        }

        .answer-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .answer-input.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .answer-input.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .hint {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        .hint-title {
            font-weight: 700;
            color: #856404;
            margin-bottom: 5px;
        }

        .hint-content {
            color: #856404;
            font-size: 0.95em;
        }

        .explanation {
            background: #e7f3ff;
            border: 1px solid #2196F3;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        .explanation-title {
            font-weight: 700;
            color: #0d47a1;
            margin-bottom: 5px;
        }

        .explanation-content {
            color: #1565c0;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .power-helper {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid #dee2e6;
        }

        .power-helper-title {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .power-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .power-btn {
            padding: 5px 10px;
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .power-btn:hover {
            background: #667eea;
            color: white;
        }

        .actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .summary {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }

        .summary h3 {
            color: #0d47a1;
            margin-bottom: 15px;
        }

        .summary-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .tabs {
                padding: 0 10px;
            }

            .tab {
                padding: 12px 15px;
                font-size: 12px;
            }

            .tab-content {
                padding: 15px;
            }

            .expression {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Algebraic Expansion Practice</h1>
            <p>Master algebraic expansion from basic to advanced</p>
        </div>

        <div class="tabs" id="tabs"></div>

        <div id="worksheets"></div>
    </div>

    <script>
        const worksheets = [
            {
                title: "Level 1: Basic Distribution",
                difficulty: "Beginner",
                problems: [
                    { q: "5(y + 3)", a: "5y + 15", steps: "Multiply 5 by each term: 5√óy = 5y, 5√ó3 = 15" },
                    { q: "4(a + 2)", a: "4a + 8", steps: "Multiply 4 by each term: 4√óa = 4a, 4√ó2 = 8" },
                    { q: "8(w + 10)", a: "8w + 80", steps: "Multiply 8 by each term: 8√ów = 8w, 8√ó10 = 80" },
                    { q: "3(x - 7)", a: "3x - 21", steps: "Multiply 3 by each term: 3√óx = 3x, 3√ó(-7) = -21" },
                    { q: "9(s - 1)", a: "9s - 9", steps: "Multiply 9 by each term: 9√ós = 9s, 9√ó(-1) = -9" },
                    { q: "2(8 - t)", a: "16 - 2t", steps: "Multiply 2 by each term: 2√ó8 = 16, 2√ó(-t) = -2t" },
                    { q: "7(4 + h)", a: "28 + 7h", steps: "Multiply 7 by each term: 7√ó4 = 28, 7√óh = 7h" },
                    { q: "4(3y + 2)", a: "12y + 8", steps: "Multiply 4 by each term: 4√ó3y = 12y, 4√ó2 = 8" }
                ]
            },
            {
                title: "Level 2: Negative Coefficients",
                difficulty: "Beginner",
                problems: [
                    { q: "-2(w + 5)", a: "-2w - 10", steps: "Multiply -2 by each term: -2√ów = -2w, -2√ó5 = -10" },
                    { q: "-3(c + 7)", a: "-3c - 21", steps: "Multiply -3 by each term: -3√óc = -3c, -3√ó7 = -21" },
                    { q: "-8(c + 7)", a: "-8c - 56", steps: "Multiply -8 by each term: -8√óc = -8c, -8√ó7 = -56" },
                    { q: "-10(y - 2)", a: "-10y + 20", steps: "Multiply -10 by each term: -10√óy = -10y, -10√ó(-2) = 20" },
                    { q: "-7(g - 3)", a: "-7g + 21", steps: "Multiply -7 by each term: -7√óg = -7g, -7√ó(-3) = 21" },
                    { q: "-4(2w + 3)", a: "-8w - 12", steps: "Multiply -4 by each term: -4√ó2w = -8w, -4√ó3 = -12" },
                    { q: "-9(3w - 5)", a: "-27w + 45", steps: "Multiply -9 by each term: -9√ó3w = -27w, -9√ó(-5) = 45" },
                    { q: "-5(6 - c)", a: "-30 + 5c", steps: "Multiply -5 by each term: -5√ó6 = -30, -5√ó(-c) = 5c" }
                ]
            },
            {
                title: "Level 3: Variables with Exponents",
                difficulty: "Intermediate",
                problems: [
                    { q: "2w(-6w - 1)", a: "-12w¬≤ - 2w", steps: "Multiply: 2w√ó(-6w) = -12w¬≤, 2w√ó(-1) = -2w" },
                    { q: "7x(-3x - 5)", a: "-21x¬≤ - 35x", steps: "Multiply: 7x√ó(-3x) = -21x¬≤, 7x√ó(-5) = -35x" },
                    { q: "2b(9b - 6)", a: "18b¬≤ - 12b", steps: "Multiply: 2b√ó9b = 18b¬≤, 2b√ó(-6) = -12b" },
                    { q: "7n(-8n + 2)", a: "-56n¬≤ + 14n", steps: "Multiply: 7n√ó(-8n) = -56n¬≤, 7n√ó2 = 14n" },
                    { q: "-6d(4 + 5d)", a: "-24d - 30d¬≤", steps: "Multiply: -6d√ó4 = -24d, -6d√ó5d = -30d¬≤" },
                    { q: "-4p(-3p - 4)", a: "12p¬≤ + 16p", steps: "Multiply: -4p√ó(-3p) = 12p¬≤, -4p√ó(-4) = 16p" },
                    { q: "2t(-t - 8)", a: "-2t¬≤ - 16t", steps: "Multiply: 2t√ó(-t) = -2t¬≤, 2t√ó(-8) = -16t" },
                    { q: "-2c(7c + 9)", a: "-14c¬≤ - 18c", steps: "Multiply: -2c√ó7c = -14c¬≤, -2c√ó9 = -18c" }
                ]
            },
            {
                title: "Level 4: Simple Binomial Expansion",
                difficulty: "Intermediate",
                problems: [
                    { q: "(x + 1)(x + 8)", a: "x¬≤ + 9x + 8", steps: "FOIL: x√óx = x¬≤, x√ó8 = 8x, 1√óx = x, 1√ó8 = 8. Combine: x¬≤ + 9x + 8" },
                    { q: "(a + 2)(b - 3)", a: "ab - 3a + 2b - 6", steps: "FOIL: a√ób = ab, a√ó(-3) = -3a, 2√ób = 2b, 2√ó(-3) = -6" },
                    { q: "(2p + 5)(p + 1)", a: "2p¬≤ + 7p + 5", steps: "FOIL: 2p√óp = 2p¬≤, 2p√ó1 = 2p, 5√óp = 5p, 5√ó1 = 5. Combine: 2p¬≤ + 7p + 5" },
                    { q: "(6x + 9)(6x - 9)", a: "36x¬≤ - 81", steps: "Difference of squares: (6x)¬≤ - 9¬≤ = 36x¬≤ - 81" },
                    { q: "(11s + 4)(-s - 8)", a: "-11s¬≤ - 92s - 32", steps: "Multiply all terms and combine like terms" },
                    { q: "(5n - 1)(-10n - 8)", a: "-50n¬≤ - 30n + 8", steps: "FOIL and combine terms" },
                    { q: "(x - 4)(3y + 2)", a: "3xy + 2x - 12y - 8", steps: "Multiply each term" },
                    { q: "(2x - 5)(x + 7)", a: "2x¬≤ + 9x - 35", steps: "FOIL method" }
                ]
            },
            {
                title: "Level 5: Binomials with Powers",
                difficulty: "Intermediate",
                problems: [
                    { q: "(2x - 1)¬≤", a: "4x¬≤ - 4x + 1", steps: "Expand: (2x-1)(2x-1). Use (a-b)¬≤ = a¬≤ - 2ab + b¬≤" },
                    { q: "(3x + 2)¬≤", a: "9x¬≤ + 12x + 4", steps: "Expand: (3x+2)(3x+2). Use (a+b)¬≤ = a¬≤ + 2ab + b¬≤" },
                    { q: "(7b¬≥ + 3)(7b¬≥ - 3)", a: "49b‚Å∂ - 9", steps: "Difference of squares: (7b¬≥)¬≤ - 3¬≤ = 49b‚Å∂ - 9" },
                    { q: "(x + 5)¬≤", a: "x¬≤ + 10x + 25", steps: "Perfect square: x¬≤ + 2(x)(5) + 5¬≤ = x¬≤ + 10x + 25" },
                    { q: "(4x - 3)¬≤", a: "16x¬≤ - 24x + 9", steps: "Perfect square: (4x)¬≤ - 2(4x)(3) + 3¬≤" },
                    { q: "(2a + 5)(2a - 5)", a: "4a¬≤ - 25", steps: "Difference of squares" },
                    { q: "(w + 3)¬≤", a: "w¬≤ + 6w + 9", steps: "Perfect square trinomial" },
                    { q: "(5y - 2)¬≤", a: "25y¬≤ - 20y + 4", steps: "Perfect square trinomial" }
                ]
            },
            {
                title: "Level 6: Triple Binomial Products",
                difficulty: "Advanced",
                problems: [
                    { q: "(x + 1)(x + 3)(x - 4)", a: "x¬≥ - 13x - 12", steps: "First expand (x+1)(x+3) = x¬≤+4x+3, then multiply by (x-4)" },
                    { q: "(2x + 7)(4x + 1)¬≤", a: "32x¬≥ + 128x¬≤ + 158x + 49", steps: "First expand (4x+1)¬≤ = 16x¬≤+8x+1, then multiply" },
                    { q: "3(4x - 2)(3x - 5)", a: "36x¬≤ - 78x + 30", steps: "Expand binomials first, then multiply by 3" },
                    { q: "(a + 1)(a + 2)(a + 3)", a: "a¬≥ + 6a¬≤ + 11a + 6", steps: "Expand step by step" },
                    { q: "(t + 1)(t - 1)(t + 2)", a: "t¬≥ + 2t¬≤ - t - 2", steps: "Use difference of squares first" },
                    { q: "2(x + 1)(x - 1)(x + 3)", a: "2x¬≥ + 6x¬≤ - 2x - 6", steps: "Expand systematically" },
                    { q: "(m + 2)(m - 2)(m + 4)", a: "m¬≥ + 4m¬≤ - 4m - 16", steps: "Use patterns" },
                    { q: "(y - 1)(y + 1)(y - 2)", a: "y¬≥ - 2y¬≤ - y + 2", steps: "Multiply step by step" }
                ]
            },
            {
                title: "Level 7: Complex Polynomial Products",
                difficulty: "Advanced",
                problems: [
                    { q: "(2x¬≤ + 3)(x¬≤ - 4)", a: "2x‚Å¥ - 5x¬≤ - 12", steps: "Multiply each term systematically" },
                    { q: "(x¬≥ + 2x)(x¬≤ - 3x + 1)", a: "x‚Åµ - x‚Å¥ - 5x¬≥ + 2x", steps: "Distribute x¬≥ and 2x separately" },
                    { q: "(3a¬≤ - 2)(2a¬≤ + 5)", a: "6a‚Å¥ + 11a¬≤ - 10", steps: "Multiply all combinations" },
                    { q: "(y¬≥ - 1)(y¬≤ + y + 1)", a: "y‚Åµ - 1", steps: "This is a sum of cubes pattern" },
                    { q: "(2m¬≤ + 1)(m¬≥ - 2m + 3)", a: "2m‚Åµ - 4m¬≥ + 6m¬≤ + m¬≥ - 2m + 3", steps: "Distribute both terms" },
                    { q: "(x¬≤ + x + 1)(x¬≤ - x + 1)", a: "x‚Å¥ + x¬≤ + 1", steps: "Pattern recognition helps" },
                    { q: "(a¬≥ - 2a)(a¬≤ + 3)", a: "a‚Åµ + 3a¬≥ - 2a¬≥ - 6a", steps: "Combine like terms" },
                    { q: "(2n¬≤ - n + 3)(n + 2)", a: "2n¬≥ + 3n¬≤ + n + 6", steps: "Multiply systematically" }
                ]
            },
            {
                title: "Level 8: Advanced Trinomial Products",
                difficulty: "Advanced",
                problems: [
                    { q: "(x¬≤ + 2x + 1)(x¬≤ - 2x + 1)", a: "x‚Å¥ + 2x¬≤ + 1", steps: "Notice (x+1)¬≤(x-1)¬≤ = (x¬≤+1)¬≤" },
                    { q: "(a + b + c)(a + b - c)", a: "a¬≤ + 2ab + b¬≤ - c¬≤", steps: "Group and use difference of squares" },
                    { q: "(2x + y - 3)(x - y + 2)", a: "2x¬≤ - xy - x + 4x - 2y¬≤ + 2y - 3x + 3y - 6", steps: "Multiply all nine combinations" },
                    { q: "(m¬≤ + m + 1)(m - 1)", a: "m¬≥ - 1", steps: "Geometric series pattern" },
                    { q: "(x¬≤ - x + 1)(x + 1)", a: "x¬≥ + 1", steps: "Sum of cubes factorization reversed" },
                    { q: "(2a¬≤ + 3a - 1)(a¬≤ - 2a + 4)", a: "2a‚Å¥ - a¬≥ + 3a¬≤ + 14a - 4", steps: "Multiply systematically" },
                    { q: "(y¬≤ + 2y + 4)(y - 2)", a: "y¬≥ - 8", steps: "Difference of cubes pattern" },
                    { q: "(3t¬≤ - 2t + 1)(2t + 3)", a: "6t¬≥ + 5t¬≤ - 4t + 3", steps: "Careful term combination" }
                ]
            }
        ];

        let currentWorksheet = 0;
        let progress = {};
        let attemptCounts = {};

        function init() {
            createTabs();
            createWorksheets();
            showWorksheet(0);
        }

        function createTabs() {
            const tabsContainer = document.getElementById('tabs');
            worksheets.forEach((ws, index) => {
                const tab = document.createElement('button');
                tab.className = 'tab';
                tab.textContent = ws.title;
                tab.onclick = () => showWorksheet(index);
                tabsContainer.appendChild(tab);
            });
        }

        function createWorksheets() {
            const container = document.getElementById('worksheets');
            worksheets.forEach((ws, wsIndex) => {
                const wsDiv = document.createElement('div');
                wsDiv.className = 'tab-content';
                wsDiv.id = `worksheet-${wsIndex}`;

                let html = `
                    <h2 style="color: #667eea; margin-bottom: 10px;">${ws.title}</h2>
                    <p style="color: #6c757d; margin-bottom: 20px;">Difficulty: <strong>${ws.difficulty}</strong></p>

                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-${wsIndex}" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="progress-text-${wsIndex}">0 / ${ws.problems.length} completed</div>
                `;

                ws.problems.forEach((prob, pIndex) => {
                    const qId = `q-${wsIndex}-${pIndex}`;
                    html += `
                        <div class="question" id="${qId}">
                            <div class="question-header">
                                <span class="question-number">Question ${pIndex + 1}</span>
                                <span class="question-status status-unanswered" id="${qId}-status">Not attempted</span>
                            </div>
                            <div class="expression">Expand: ${prob.q}</div>
                            <input type="text" class="answer-input" id="${qId}-input" 
                                   placeholder="Enter your answer (e.g., 2x¬≤ + 3x + 1)" 
                                   oninput="handleInput(${wsIndex}, ${pIndex})">
                            <div class="power-helper">
                                <div class="power-helper-title">Quick Powers:</div>
                                <div class="power-buttons">
                                    <button class="power-btn" onclick="insertPower(${wsIndex}, ${pIndex}, '¬≤')">x¬≤</button>
                                    <button class="power-btn" onclick="insertPower(${wsIndex}, ${pIndex}, '¬≥')">x¬≥</button>
                                    <button class="power-btn" onclick="insertPower(${wsIndex}, ${pIndex}, '‚Å¥')">x‚Å¥</button>
                                    <button class="power-btn" onclick="insertPower(${wsIndex}, ${pIndex}, '‚Åµ')">x‚Åµ</button>
                                    <button class="power-btn" onclick="insertPower(${wsIndex}, ${pIndex}, '‚Å∂')">x‚Å∂</button>
                                    <button class="power-btn" onclick="insertPower(${wsIndex}, ${pIndex}, '‚Å∑')">x‚Å∑</button>
                                    <button class="power-btn" onclick="insertPower(${wsIndex}, ${pIndex}, '‚Å∏')">x‚Å∏</button>
                                    <button class="power-btn" onclick="insertPower(${wsIndex}, ${pIndex}, '‚Åπ')">x‚Åπ</button>
                                    <button class="power-btn" onclick="insertPower(${wsIndex}, ${pIndex}, '¬π‚Å∞')">x¬π‚Å∞</button>
                                </div>
                            </div>
                            <div class="hint" id="${qId}-hint">
                                <div class="hint-title">üí° Hint:</div>
                                <div class="hint-content">${prob.steps}</div>
                            </div>
                            <div class="explanation" id="${qId}-explanation">
                                <div class="explanation-title">üìù Solution:</div>
                                <div class="explanation-content">
                                    <strong>Answer:</strong> ${prob.a}<br>
                                    <strong>Steps:</strong> ${prob.steps}
                                </div>
                            </div>
                            <div class="button-group">
                                <button class="btn btn-primary" onclick="checkAnswer(${wsIndex}, ${pIndex})">Check Answer</button>
                                <button class="btn btn-secondary" onclick="showHint(${wsIndex}, ${pIndex})">Show Hint</button>
                            </div>
                        </div>
                    `;
                });

                html += `
                    <div class="actions">
                        <button class="btn btn-success" onclick="checkAllAnswers(${wsIndex})">Check All Answers</button>
                        <button class="btn btn-secondary" onclick="resetWorksheet(${wsIndex})">Reset Worksheet</button>
                    </div>
                    <div class="summary" id="summary-${wsIndex}" style="display: none;">
                        <h3>üìä Worksheet Summary</h3>
                        <div class="summary-stats">
                            <div class="stat">
                                <div class="stat-value" id="correct-${wsIndex}">0</div>
                                <div class="stat-label">Correct</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="incorrect-${wsIndex}">0</div>
                                <div class="stat-label">Incorrect</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="percentage-${wsIndex}">0%</div>
                                <div class="stat-label">Score</div>
                            </div>
                        </div>
                    </div>
                `;

                wsDiv.innerHTML = html;
                container.appendChild(wsDiv);
            });
        }

        function showWorksheet(index) {
            document.querySelectorAll('.tab').forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });
            document.querySelectorAll('.tab-content').forEach((content, i) => {
                content.classList.toggle('active', i === index);
            });
            currentWorksheet = index;
        }

        function insertPower(wsIndex, pIndex, power) {
            const input = document.getElementById(`q-${wsIndex}-${pIndex}-input`);
            const start = input.selectionStart;
            const end = input.selectionEnd;
            const text = input.value;
            input.value = text.substring(0, start) + power + text.substring(end);
            input.focus();
            input.setSelectionRange(start + power.length, start + power.length);
        }

        function normalizeAnswer(answer) {
            return answer.toLowerCase()
                .replace(/\s+/g, '')
                .replace(/\*+/g, '')
                .replace(/\^2/g, '¬≤')
                .replace(/\^3/g, '¬≥')
                .replace(/\^4/g, '‚Å¥')
                .replace(/\^5/g, '‚Åµ')
                .replace(/\^6/g, '‚Å∂')
                .replace(/\^7/g, '‚Å∑')
                .replace(/\^8/g, '‚Å∏')
                .replace(/\^9/g, '‚Åπ')
                .replace(/\^10/g, '¬π‚Å∞')
                .replace(/\+\-/g, '-')
                .replace(/\-\+/g, '-');
        }

        function checkAnswer(wsIndex, pIndex) {
            const qId = `q-${wsIndex}-${pIndex}`;
            const input = document.getElementById(`${qId}-input`);
            const status = document.getElementById(`${qId}-status`);
            const userAnswer = normalizeAnswer(input.value);
            const correctAnswer = normalizeAnswer(worksheets[wsIndex].problems[pIndex].a);

            attemptCounts[qId] = (attemptCounts[qId] || 0) + 1;

            if (userAnswer === correctAnswer) {
                input.className = 'answer-input correct';
                status.className = 'question-status status-correct';
                status.textContent = '‚úì Correct!';
                progress[qId] = true;
                document.getElementById(`${qId}-explanation`).style.display = 'block';
            } else {
                input.className = 'answer-input incorrect';
                status.className = 'question-status status-incorrect';
                status.textContent = '‚úó Incorrect';
                progress[qId] = false;

                if (attemptCounts[qId] >= 2) {
                    document.getElementById(`${qId}-explanation`).style.display = 'block';
                }
            }

            updateProgress(wsIndex);
        }

        function showHint(wsIndex, pIndex) {
            const qId = `q-${wsIndex}-${pIndex}`;
            const hint = document.getElementById(`${qId}-hint`);
            hint.style.display = hint.style.display === 'none' ? 'block' : 'none';
        }

        function handleInput(wsIndex, pIndex) {
            const qId = `q-${wsIndex}-${pIndex}`;
            const input = document.getElementById(`${qId}-input`);
            input.className = 'answer-input';
        }

        function updateProgress(wsIndex) {
            const problems = worksheets[wsIndex].problems;
            let completed = 0;
            let correct = 0;

            problems.forEach((prob, pIndex) => {
                const qId = `q-${wsIndex}-${pIndex}`;
                if (progress[qId] !== undefined) {
                    completed++;
                    if (progress[qId]) correct++;
                }
            });

            const percentage = Math.round((completed / problems.length) * 100);
            document.getElementById(`progress-${wsIndex}`).style.width = percentage + '%';
            document.getElementById(`progress-text-${wsIndex}`).textContent = 
                `${completed} / ${problems.length} completed (${correct} correct)`;
        }

        function checkAllAnswers(wsIndex) {
            worksheets[wsIndex].problems.forEach((prob, pIndex) => {
                const qId = `q-${wsIndex}-${pIndex}`;
                const input = document.getElementById(`${qId}-input`);
                if (input.value.trim() !== '') {
                    checkAnswer(wsIndex, pIndex);
                }
            });

            showSummary(wsIndex);
        }

        function showSummary(wsIndex) {
            const problems = worksheets[wsIndex].problems;
            let correct = 0;
            let incorrect = 0;

            problems.forEach((prob, pIndex) => {
                const qId = `q-${wsIndex}-${pIndex}`;
                if (progress[qId] === true) correct++;
                else if (progress[qId] === false) incorrect++;
            });

            const percentage = problems.length > 0 ? Math.round((correct / problems.length) * 100) : 0;

            document.getElementById(`correct-${wsIndex}`).textContent = correct;
            document.getElementById(`incorrect-${wsIndex}`).textContent = incorrect;
            document.getElementById(`percentage-${wsIndex}`).textContent = percentage + '%';
            document.getElementById(`summary-${wsIndex}`).style.display = 'block';
        }

        function resetWorksheet(wsIndex) {
            if (!confirm('Are you sure you want to reset this worksheet? All progress will be lost.')) {
                return;
            }

            worksheets[wsIndex].problems.forEach((prob, pIndex) => {
                const qId = `q-${wsIndex}-${pIndex}`;
                document.getElementById(`${qId}-input`).value = '';
                document.getElementById(`${qId}-input`).className = 'answer-input';
                document.getElementById(`${qId}-status`).className = 'question-status status-unanswered';
                document.getElementById(`${qId}-status`).textContent = 'Not attempted';
                document.getElementById(`${qId}-hint`).style.display = 'none';
                document.getElementById(`${qId}-explanation`).style.display = 'none';
                delete progress[qId];
                delete attemptCounts[qId];
            });

            document.getElementById(`summary-${wsIndex}`).style.display = 'none';
            updateProgress(wsIndex);
        }

        window.onload = init;
    </script>
</body>
</html>
